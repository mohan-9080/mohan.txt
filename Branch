#include <Wire.h>
#include <Adafruit_Sensor.h>
#include <Adafruit_ADXL345_U.h>
Adafruit_ADXL345_Unified accel = Adafruit_ADXL345_Unified();

#include <Wire.h>
#include <LiquidCrystal_I2C.h>
LiquidCrystal_I2C lcd(0x27, 16, 2);

#include <SoftwareSerial.h>
int buzzer = 5;
int led = 11;
SoftwareSerial mySerial(8, 7); //SIM800L Tx & Rx is connected to Arduino #3
& #2

void setup()
{
   Serial.begin(9600);
   mySerial.begin(9600);
   if(!accel.begin())
   {
      Serial.println("No valid sensor found");
      while(1);
   }
    lcd.init();
    lcd.backlight();
    lcd.clear();
    lcd.setCursor(0,0);
    lcd.print("VEHICLE ACCIDENT");
    lcd.setCursor(0,1);
    lcd.print("DETECTION SYSTEM");
    delay(2000);
}

void loop()
{
sensors_event_t event;
accel.getEvent(&event);
Serial.print("X: "); Serial.print(event.acceleration.x); Serial.print("");
Serial.print("Y: "); Serial.print(event.acceleration.y); Serial.print("");
Serial.print("Z: "); Serial.print(event.acceleration.z); Serial.print("");
Serial.println("m/s^2 ");
delay(500);

  int ax=event.acceleration.x;
  int ay=event.acceleration.y;
  int az=event.acceleration.z;

lcd.clear();
lcd.setCursor(0,0);
lcd.print("  X  |  Y  |  Z ");

  lcd.setCursor(1,1);
  lcd.print(ax);
  lcd.setCursor(5,1);
  lcd.print("|");
  lcd.setCursor(7,1);
  lcd.print(ay);
  lcd.setCursor(11,1);
  lcd.print("|");
  lcd.setCursor(13,1);
  lcd.print(az);
  delay(500);
if(az<=2)
{

    lcd.clear();
    lcd.setCursor(0,0);
    lcd.print("IMPACT  DETECTED");
    lcd.setCursor(0,1);
    lcd.print("ON YOUR VEHICLE!");
  action();
  delay(2000);

}

}

void action()
{
  Serial.println("Initializing...");
  delay(1000);

  mySerial.println("AT"); //Once the handshake test is successful, it will
back to OK
  updateSerial();

  mySerial.println("AT+CMGF=1"); // Configuring TEXT mode
  updateSerial();
 mySerial.println("AT+CMGS=\"+919080531817\"");//change ZZ with country
code and xxxxxxxxxxx with phone number to sms
  updateSerial();
  mySerial.print("Severe Impact Detected On Your Vehicle at
https://maps.app.goo.gl/obvmtf2NTEaHw7k47?g_st=aw"); //text content
  updateSerial();
  mySerial.write(26);
}

void updateSerial()
{
  delay(500);
  while (Serial.available())
  {
    mySerial.write(Serial.read());//Forward what Serial received to
Software Serial Port
  }
  while(mySerial.available())
  {
    Serial.write(mySerial.read());//Forward what Software Serial received
to Serial Port
  }
}
